<!DOCTYPE html>
<html>
  <head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155991615-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-155991615-1');
    </script>
    <!-- my stuff -->
    <meta charset="utf-8">
    <title>ACT COVID-19 hotspots</title>
    <meta name="author" content="Markus Mannheim">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Initial scripts -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css" rel="stylesheet">
    <link href="./resources/mapStyle.css" rel="stylesheet">
    <link href="./resources/abcLogo64.png" rel="icon">
  </head>
  <body>
    <div id="map"></div>
    <script>
      // load LGA data
      Promise.all([
        d3.json("./data/nbData.topojson"),
        d3.json("./data/lgaData.topojson")
      ]).then(function(data) {
          lgas = topojson.feature(data[1], data[1].objects.areas);
          northernBeaches = topojson.feature(data[0], data[0].objects.areas);
          // set up MapBox engine
          mapboxgl.accessToken = "pk.eyJ1IjoibmV3cy1vbjFpbmUiLCJhIjoiR3FlZFZlVSJ9._30EFE9XYhQitqf4gzRG-g";
          map = new mapboxgl.Map({
            container: "map",
            attributionControl: false,
            style: "mapbox://styles/mapbox/light-v10",
            center: [149.126944, -35.293056],
            zoom: 8
          });
          map.on("load", function() {
            // add navigation and custom attribution
            map.addControl(new mapboxgl.NavigationControl())
              .addControl(new mapboxgl.AttributionControl({
                compact: true,
                customAttribution: "ACT Health (COVID-19 advice), ABS (LGA boundaries)"
              }))
              // add GeoJSON
              .addSource("other", {
                type: "geojson",
                data: lgas
              })
              .addSource("nb", {
                type: "geojson",
                data: northernBeaches
              })
              .addLayer({
                id: "other",
                type: "fill",
                source: "other",
                paint: {
                  "fill-color": "#01CFFF",
                  "fill-opacity": .75,
                  "fill-outline-color": "white"
                }
              })
              .addLayer({
                id: "nb",
                type: "fill",
                source: "nb",
                paint: {
                  "fill-color": "#FF6100",
                  "fill-opacity": .75,
                  "fill-outline-color": "white"
                }
              });
            // fade in
            d3.select("body")
              .transition()
                .duration(500)
                .style("opacity", 1);
            // transition to LGAs
            d3.timeout(function() {
              bounds = d3.geoBounds(lgas);
              map.fitBounds(bounds, {
                padding: 32,
                duration: 5000,
                essential: true
              });
            }, 1000);
          });
        });
    </script>
  </body>
</html>
